<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>韓立修仙編年史 - 凡人修仙傳 (V10.0)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.468.0?external=react"
        }
    }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        body { background-color: #020617; }
        
        .orbit-container {
            position: relative;
            width: 100%;
            height: 800px;
            overflow: hidden;
        }
        
        .orbit-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            border-radius: 50%;
            border: 1px dashed rgba(71, 85, 105, 0.3);
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .planet-node {
            position: absolute;
            transform: translate(-50%, -50%);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .planet-node:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 50;
        }

        .star-pulse {
            animation: pulse-glow 3s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
            50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { ChevronDown, ChevronUp, Search, Shield, Zap, BookOpen, MapPin, Users, Gem, Skull, Globe, Star, Sparkles, Cloud, Activity, Hourglass, Landmark, Flag, Anchor, Navigation, PawPrint, Hammer, Share2, Clock, Info, Heart, Swords, GraduationCap, Ghost } from 'lucide-react';

        // --- RELATIONSHIP DATA (V10.0 Final Verified) ---
        const RELATIONSHIPS = [
            // --- Ring 1: Inner Circle (Soulbound / Family) ---
            { id: 'r1', name: '南宮婉', relation: '正妻道侶', type: 'LOVE', ring: 1, angle: 0, desc: '掩月宗相遇，結為道侶，韓立心中最重要的羈絆。飛升後在仙界重逢。' },
            { id: 'r2', name: '紫靈仙子', relation: '紅顏知己', type: 'LOVE', ring: 1, angle: 60, desc: '亂星海第一美女，與韓立糾纏數界，魔界重逢，最終在仙界相伴。' },
            { id: 'r3', name: '銀月', relation: '器靈/知己', type: 'LOVE', ring: 1, angle: 120, desc: '曾寄身虛天鼎與韓立相伴多年，靈界銀月狼族玲瓏妖妃。' },
            { id: 'r4', name: '金童', relation: '本命靈獸', type: 'PET', ring: 1, angle: 180, desc: '噬金蟲王進階而成，無物不噬，道祖級戰力，韓立最強幫手。' },
            { id: 'r5', name: '啼魂', relation: '刑獸', type: 'PET', ring: 1, angle: 240, desc: '亂星海所得，專克鬼物，後覺醒為仙界刑獸，隨韓立征戰冥界。' },
            { id: 'r_mp', name: '慕沛靈', relation: '名義侍妾', type: 'LOVE', ring: 1, angle: 300, desc: '落雲宗女修，為拒絕他人騷擾自願成為韓立侍妾。韓立對其有庇護之情，最終坐化。' },
            
            // --- Ring 2: Middle Circle (Friends / Allies / Disciples) ---
            { id: 'r6', name: '厲飛雨', relation: '生死兄弟', type: 'FRIEND', ring: 2, angle: 0, desc: '「殺人放火厲飛雨」，韓立凡人時期的摯友。韓立用其名號行走江湖萬年。' },
            { id: 'r11', name: '蟹道人', relation: '忠誠守護', type: 'FRIEND', ring: 2, angle: 30, desc: '偽仙傫，本體為傀儡道祖。話少靠譜，韓立最強保鏢。' },
            { id: 'r9', name: '元瑤', relation: '鬼道紅顏', type: 'FRIEND', ring: 2, angle: 60, desc: '虛天殿相識，為救師姐修鬼道，與韓立多次患難。' },
            { id: 'r10', name: '陳巧倩', relation: '痴情遺憾', type: 'LOVE', ring: 2, angle: 90, desc: '黃楓谷師姐，對韓立一往情深，韓立為求大道拒絕，終身未嫁。' },
            { id: 'r14', name: '冰鳳', relation: '盟友/冤家', type: 'FRIEND', ring: 2, angle: 120, desc: '人界死敵，後聯手偷渡靈界。在靈界多次互助。' },
            { id: 'r15', name: '石穿空', relation: '仙界基友', type: 'FRIEND', ring: 2, angle: 150, desc: '廣寒界主之子，與韓立在積鱗空境共患難，性格豪爽。' },
            { id: 'r16', name: '辛如音', relation: '陣法奇才', type: 'FRIEND', ring: 2, angle: 180, desc: '龍吟之體，陣法天賦極高。為韓立修復古傳送陣。' },
            { id: 'r_bh', name: '寶花', relation: '魔界始祖', type: 'FRIEND', ring: 2, angle: 210, desc: '魔界三大始祖之一，智慧與實力並存。與韓立多次合作，關係微妙。' },
            { id: 'r_ly', name: '柳玉', relation: '記名弟子', type: 'MASTER', ring: 2, angle: 240, desc: '亂星海收的記名弟子，繼承了韓立部分衣缽。' },
            { id: 'r_tqe', name: '田琴兒', relation: '陣法弟子', type: 'MASTER', ring: 2, angle: 270, desc: '辛如音轉世，韓立收其為徒，傳授陣法之道。' },
            { id: 'r_hds', name: '海大少', relation: '靈界弟子', type: 'MASTER', ring: 2, angle: 300, desc: '靈界天淵城收的弟子，性格跳脫但天賦極高。' },
            { id: 'r_qlz', name: '器靈子', relation: '靈界弟子', type: 'MASTER', ring: 2, angle: 330, desc: '靈界天淵城收的弟子，擅長煉器。' },
             { id: 'r_lyz', name: '雷雲子', relation: '雷法道友', type: 'FRIEND', ring: 2, angle: 350, desc: '靈界雷鳴大陸修士，與韓立交換雷法心得，互贈雷陣。' },


            // --- Ring 3: Seniors & Mentors ---
            { id: 'r7', name: '大衍神君', relation: '亦師亦友', type: 'MASTER', ring: 3, angle: 0, desc: '傀儡術宗師，傳授大衍決，韓立神識強大的奠基人。' },
            { id: 'r8', name: '墨大夫', relation: '師父/仇人', type: 'MASTER', ring: 3, angle: 45, desc: '領韓立進門，卻圖謀奪舍。教會了韓立修仙界的殘酷。' },
            { id: 'r17', name: '李化元', relation: '授業恩師', type: 'MASTER', ring: 3, angle: 90, desc: '黃楓谷師尊，為人護短。' },
            { id: 'r12', name: '青元子', relation: '前輩/岳父', type: 'MASTER', ring: 3, angle: 135, desc: '靈界大能，傳授新青元劍訣與劍陣。' },
            { id: 'r_mjl', name: '莫簡離', relation: '人族大乘', type: 'FRIEND', ring: 3, angle: 180, desc: '靈界人族唯一大乘（韓立之前），對韓立多有照拂。' },
            { id: 'r_ax', name: '敖嘯老祖', relation: '妖族大乘', type: 'FRIEND', ring: 3, angle: 225, desc: '銀月的祖父，靈界妖族大乘，韓立的強力後盾。' },
            { id: 'r_hy', name: '呼言道人', relation: '仙界酒友', type: 'FRIEND', ring: 3, angle: 270, desc: '真言門倖存者，不拘小節，傳授韓立煉器之道。' },
            { id: 'r_bg', name: '白果兒', relation: '冰髓之體', type: 'MASTER', ring: 3, angle: 315, desc: '靈界收的記名弟子，身具特殊體質。' },

            // --- Ring 4: Outer Circle (Enemies / Rivals / Slain) ---
            { id: 'k1', name: '古或今', relation: '滅殺', type: 'KILLED', ring: 4, angle: 0, desc: '【仙界BOSS】時間道祖。企圖獻祭三界，被韓立斬殺。' },
            { id: 'k2', name: '馬良', relation: '滅殺', type: 'KILLED', ring: 4, angle: 20, desc: '【真仙】下界血祭萬靈。韓立集全靈界之力將其斬殺。' },
            { id: 'k3', name: '六道極聖', relation: '滅殺', type: 'KILLED', ring: 4, angle: 40, desc: '【亂星海】魔道第一人。韓立進階元嬰後期後將其擊殺。' },
            { id: 'k4', name: '玄骨上人', relation: '滅殺', type: 'KILLED', ring: 4, angle: 60, desc: '【虛天殿】極陰之師。心機深沉，被韓立用辟邪神雷擊殺。' },
            { id: 'k5', name: '陸師兄', relation: '首殺', type: 'KILLED', ring: 4, angle: 80, desc: '【黃楓谷】韓立修仙界第一滴血。' },
            { id: 'k6', name: '風希', relation: '滅殺', type: 'KILLED', ring: 4, angle: 100, desc: '【裂風獸】曾逼韓立煉寶。被奪妖丹，煉製風雷翅。' },
            { id: 'k7', name: '極陰祖師', relation: '滅殺', type: 'KILLED', ring: 4, angle: 120, desc: '【亂星海】想收韓立為徒（奪舍）。後被擒獲餵蠻鬍子。' },
            { id: 'k8', name: '墨蛟', relation: '滅殺', type: 'KILLED', ring: 4, angle: 140, desc: '【血色禁地】二級妖獸。其淫囊促成了韓立姻緣。' },
            { id: 'k9', name: '乾老魔', relation: '滅殺', type: 'KILLED', ring: 4, angle: 160, desc: '【大晉】陰羅宗大長老。元嬰被煉化為第二元嬰。' },
            { id: 'k10', name: '陶羽', relation: '滅殺', type: 'KILLED', ring: 4, angle: 180, desc: '【北寒仙域】金仙。曾在韓立飛升時偷襲。' },
            { id: 'k11', name: '蕭晉寒', relation: '滅殺', type: 'KILLED', ring: 4, angle: 200, desc: '【北寒仙宮】宮主。在冥寒仙府被韓立斬殺。' },
            { id: 'k12', name: '金光上人', relation: '滅殺', type: 'KILLED', ring: 4, angle: 220, desc: '【凡人篇】野狼幫供奉。貢獻昇仙令的送寶童子。' },
            { id: 'k13', name: '奇摩子', relation: '滅殺', type: 'KILLED', ring: 4, angle: 240, desc: '【真言門叛徒】投靠天庭。在歲月之塔被斬。' },
            { id: 'k14', name: '血光聖祖', relation: '滅殺', type: 'KILLED', ring: 4, angle: 260, desc: '【魔界始祖】靈界大戰統帥。韓立進階大乘後將其斬殺。' },
            { id: 'k15', name: '螟蟲之母', relation: '滅殺', type: 'KILLED', ring: 4, angle: 280, desc: '【上古凶蟲】真仙級存在。韓立與寶花聯手斬殺。' },
            { id: 'k16', name: '元剎聖祖', relation: '滅殺', type: 'KILLED', ring: 4, angle: 300, desc: '【魔界始祖】人界昆吾山分魂被滅，靈界大戰時本體降臨，終被韓立所敗。' },
            { id: 'k17', name: '蠻鬍子', relation: '亡魂', type: 'KILLED', ring: 4, angle: 320, desc: '【亂星海】第一體修。虛天殿威風八面，後死於極陰算計。' },
            { id: 'k18', name: '王嬋', relation: '宿敵', type: 'ENEMY', ring: 4, angle: 340, desc: '【鬼靈門】少主。前期大敵，後期路人，道心崩潰。' },
        ];

        // --- COMPONENTS ---

        const RelationshipGraph = ({ onSelectNode }) => {
            const [selectedNode, setSelectedNode] = useState(null);
            const [filter, setFilter] = useState('ALL'); 

            // Filter Logic
            const visibleNodes = useMemo(() => {
                if (filter === 'ALL') return RELATIONSHIPS;
                return RELATIONSHIPS.filter(node => {
                    if (filter === 'LOVE') return node.type === 'LOVE';
                    if (filter === 'FRIEND') return node.type === 'FRIEND';
                    if (filter === 'MASTER') return node.type === 'MASTER';
                    if (filter === 'ENEMY') return node.type === 'ENEMY';
                    if (filter === 'KILLED') return node.type === 'KILLED';
                    return true;
                });
            }, [filter]);

            const getPos = (ring, angle) => {
                const radius = ring * 85; 
                const radian = (angle * Math.PI) / 180;
                return {
                    x: Math.cos(radian) * radius,
                    y: Math.sin(radian) * radius,
                };
            };

            const handleNodeClick = (node) => {
                setSelectedNode(node);
            };

            const FilterButton = ({ type, label, icon: Icon, colorClass }) => (
                <button 
                    onClick={() => setFilter(type)}
                    className={`px-3 py-1.5 rounded-full text-[10px] md:text-xs font-bold flex items-center gap-1.5 transition-all border ${
                        filter === type 
                        ? `${colorClass} text-white shadow-lg scale-105` 
                        : 'bg-slate-900/50 border-slate-700 text-slate-500 hover:text-slate-300'
                    }`}
                >
                    <Icon size={12} /> {label}
                </button>
            );

            return (
                <div className="relative w-full h-[800px] bg-slate-950 overflow-hidden flex flex-col items-center select-none border border-slate-800 rounded-xl mt-4 cursor-default">
                    
                    {/* Filter Bar */}
                    <div className="absolute top-4 left-0 right-0 z-40 flex flex-wrap justify-center gap-2 px-4 pointer-events-auto">
                        <FilterButton type="ALL" label="全部" icon={Globe} colorClass="bg-slate-600 border-slate-500" />
                        <FilterButton type="LOVE" label="真愛/羈絆" icon={Heart} colorClass="bg-pink-600 border-pink-500" />
                        <FilterButton type="MASTER" label="師徒/傳承" icon={GraduationCap} colorClass="bg-amber-600 border-amber-500" />
                        <FilterButton type="FRIEND" label="盟友/道友" icon={Users} colorClass="bg-blue-600 border-blue-500" />
                        <FilterButton type="ENEMY" label="宿敵/對手" icon={Swords} colorClass="bg-red-600 border-red-500" />
                        <FilterButton type="KILLED" label="滅殺/亡魂" icon={Ghost} colorClass="bg-zinc-600 border-zinc-500" />
                    </div>

                    <div className="relative w-full h-full flex items-center justify-center mt-8">
                        {/* Background Grid */}
                        <div className="absolute inset-0 opacity-20 pointer-events-none" 
                             style={{ backgroundImage: 'radial-gradient(#334155 1px, transparent 1px)', backgroundSize: '30px 30px' }}></div>

                        {/* Rings */}
                        <div className="orbit-ring w-[170px] h-[170px] border-emerald-500/20"></div>
                        <div className="orbit-ring w-[340px] h-[340px] border-blue-500/20"></div>
                        <div className="orbit-ring w-[510px] h-[510px] border-amber-500/20"></div>
                        <div className="orbit-ring w-[680px] h-[680px] border-red-500/20"></div>

                        {/* Center Node (Han Li) */}
                        <div className="absolute z-20 flex flex-col items-center justify-center">
                            <div className="w-14 h-14 md:w-16 md:h-16 rounded-full bg-slate-900 border-2 border-emerald-400 flex items-center justify-center star-pulse">
                                <span className="text-emerald-400 font-bold text-base md:text-lg">韓立</span>
                            </div>
                            <span className="mt-2 text-[10px] text-slate-400 bg-slate-900/80 px-2 py-0.5 rounded backdrop-blur">韓天尊</span>
                        </div>

                        {/* Orbit Nodes */}
                        {visibleNodes.map((node) => {
                            const pos = getPos(node.ring, node.angle);
                            const isSelected = selectedNode?.id === node.id;
                            
                            let nodeColor = 'border-slate-500 text-slate-300';
                            if (node.type === 'LOVE') nodeColor = 'border-pink-500 text-pink-400 shadow-[0_0_10px_rgba(236,72,153,0.3)]';
                            if (node.type === 'FRIEND') nodeColor = 'border-blue-500 text-blue-400';
                            if (node.type === 'MASTER') nodeColor = 'border-amber-500 text-amber-400';
                            if (node.type === 'PET') nodeColor = 'border-purple-500 text-purple-400';
                            if (node.type === 'ENEMY') nodeColor = 'border-red-500 text-red-400';
                            if (node.type === 'KILLED') nodeColor = 'border-zinc-600 text-zinc-500 bg-zinc-950/80';

                            return (
                                <div 
                                    key={node.id}
                                    className={`planet-node flex flex-col items-center cursor-pointer group`}
                                    style={{ transform: `translate(calc(-50% + ${pos.x}px), calc(-50% + ${pos.y}px))` }}
                                    onClick={() => handleNodeClick(node)}
                                >
                                    <div className={`w-9 h-9 md:w-10 md:h-10 rounded-full bg-slate-900 border flex items-center justify-center transition-all duration-300 ${nodeColor} ${isSelected ? 'scale-125 ring-2 ring-white/50 z-30' : 'group-hover:scale-110'}`}>
                                        {node.type === 'KILLED' ? (
                                            <span className="text-[8px] font-bold line-through opacity-70">{node.name}</span>
                                        ) : (
                                            <span className="text-[8px] md:text-[9px] font-bold text-center leading-tight px-0.5">{node.name}</span>
                                        )}
                                    </div>
                                    <span className={`mt-1 text-[8px] px-1.5 py-0.5 rounded bg-slate-900/80 border border-slate-800 whitespace-nowrap backdrop-blur-sm ${isSelected ? 'text-white' : 'text-slate-500'}`}>
                                        {node.relation}
                                    </span>
                                </div>
                            );
                        })}
                    </div>

                    {/* Detail Card Overlay */}
                    {selectedNode && (
                        <div className="absolute bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-slate-800/95 backdrop-blur border border-slate-600 rounded-xl p-4 shadow-2xl animate-in slide-in-from-bottom-4 fade-in z-50">
                            <div className="flex justify-between items-start mb-2">
                                <h3 className={`text-lg font-bold ${
                                    selectedNode.type === 'LOVE' ? 'text-pink-400' :
                                    selectedNode.type === 'ENEMY' ? 'text-red-400' :
                                    selectedNode.type === 'KILLED' ? 'text-zinc-400 line-through decoration-red-500 decoration-2' :
                                    selectedNode.type === 'MASTER' ? 'text-amber-400' :
                                    'text-emerald-400'
                                }`}>{selectedNode.name}</h3>
                                <button onClick={() => setSelectedNode(null)} className="text-slate-500 hover:text-white">✕</button>
                            </div>
                            <div className="text-xs text-slate-400 mb-2 flex gap-2">
                                <span className="bg-slate-900 px-1.5 py-0.5 rounded">{selectedNode.relation}</span>
                                <span className="bg-slate-900 px-1.5 py-0.5 rounded">
                                    {selectedNode.type === 'LOVE' ? '靈魂羈絆' : 
                                     selectedNode.type === 'KILLED' ? '已斬殺/隕落' :
                                     selectedNode.type === 'ENEMY' ? '宿敵/反派' : 
                                     selectedNode.type === 'MASTER' ? '師尊/傳承' :
                                     selectedNode.type === 'PET' ? '靈獸' : '師友/盟友'}
                                </span>
                            </div>
                            <p className="text-sm text-slate-300 leading-relaxed">
                                {selectedNode.desc}
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        const HanLiChronicle = () => {
            const [viewMode, setViewMode] = useState('TIMELINE'); 
            const [activeWorld, setActiveWorld] = useState('HUMAN'); 
            const [filterType, setFilterType] = useState('ALL');
            const [searchTerm, setSearchTerm] = useState('');
            const [expandedId, setExpandedId] = useState(null);
            
            const APP_VERSION = "v10.0 (Defitive Edition)";

            // 定義事件類型
            const EVENT_TYPES = {
                STATUS: { label: '遊歷/潛修', color: 'text-slate-400', border: 'border-slate-500/50', bg: 'bg-slate-600', icon: Anchor, desc: '宗門掛靠與地圖變遷' },
                CULTIVATION: { label: '境界突破', color: 'text-emerald-400', border: 'border-emerald-500/50', bg: 'bg-emerald-500', icon: Shield },
                TREASURE: { label: '奪寶機緣', color: 'text-amber-400', border: 'border-amber-500/50', bg: 'bg-amber-500', icon: Gem },
                TECHNIQUE: { label: '功法神通', color: 'text-blue-400', border: 'border-blue-500/50', bg: 'bg-blue-500', icon: BookOpen },
                EVENT: { label: '關鍵副本', color: 'text-gray-200', border: 'border-gray-500/50', bg: 'bg-gray-500', icon: Zap },
                FIGHT: { label: '血戰殺伐', color: 'text-red-400', border: 'border-red-500/50', bg: 'bg-red-500', icon: Skull },
                PET_EVO: { label: '靈獸/法寶進化', color: 'text-purple-400', border: 'border-purple-500/50', bg: 'bg-purple-500', icon: PawPrint },
                CRAFT: { label: '丹符陣器', color: 'text-orange-400', border: 'border-orange-500/50', bg: 'bg-orange-500', icon: Hammer }
            };

            const WORLDS = {
                HUMAN: { label: '人界篇', icon: Globe, color: 'from-emerald-400 to-cyan-300', desc: '凡人 · 亂星 · 大晉', years: '10歲 - 900歲' },
                SPIRIT: { label: '靈界篇', icon: Cloud, color: 'from-purple-400 to-pink-300', desc: '百族 · 魔界 · 大乘', years: '1000歲 - 11000歲' },
                IMMORTAL: { label: '仙界篇', icon: Sparkles, color: 'from-amber-300 to-yellow-500', desc: '真仙 · 道祖 · 永生', years: '11000歲 - 永恆' },
            };

            // 數據庫 V10.0 (Verified Fixes)
            const ALL_DATA = {
                HUMAN: [
                { id: 'h0', age: 10, realm: '凡人', type: 'STATUS', title: '山村少年', location: '天南大陸 > 鏡州 > 青牛鎮', forces: ['凡人村落'], races: ['人族'], characters: ['二愣子(韓立)', '韓父母'], description: '出生於貧苦農家，度過了普通的童年。尚未接觸修仙界，性格淳樸（暫時）。', gained: [], lost: [], techniques: [] },
                { id: 'h1', age: 10, realm: '凡人', type: 'EVENT', title: '七玄門入門', location: '天南大陸 > 鏡州 > 七玄門', forces: ['七玄門'], races: ['人族'], characters: ['韓立', '厲飛雨', '張鐵'], description: '隨三叔參加測試。雖未被錄取，但因身具靈根（雖不知道）被墨大夫收為弟子。', gained: ['長春功口訣'], lost: ['凡人生活'], techniques: [] },
                { id: 'h2', age: 14, realm: '煉氣期 一層', type: 'TREASURE', title: '掌天瓶現世', location: '天南大陸 > 鏡州 > 神手谷', forces: ['七玄門'], races: ['人族'], characters: ['韓立'], description: '意外拾得神秘小綠瓶。發現其能凝聚綠液催熟靈藥，從此走上「嗑藥修仙」之路。', gained: ['掌天瓶(殘缺)'], lost: [], techniques: ['長春功'] },
                { id: 'h3', age: 16, realm: '煉氣期 六層', type: 'FIGHT', title: '墨大夫奪舍', location: '天南大陸 > 鏡州 > 神手谷', forces: ['七玄門'], races: ['人族'], characters: ['韓立', '墨大夫', '余子童'], description: '墨大夫圖窮匕見，韓立反殺墨大夫，囚禁余子童元神，獲得修仙界常識。', gained: ['暖陽寶玉', '長春功全本'], lost: ['師徒情分'], techniques: ['眨眼劍法', '羅煙步'] },
                { id: 'h5', age: 21, realm: '煉氣期 十一層', type: 'CULTIVATION', title: '拜入黃楓谷', location: '天南大陸 > 越國 > 黃楓谷', forces: ['越國七派'], races: ['人族'], characters: ['韓立', '葉師叔'], description: '持昇仙令加入黃楓谷。因資質低劣（四偽靈根），擔任百藥園看守弟子。', gained: ['黃楓谷弟子身份'], lost: ['昇仙令'], techniques: ['烈火彈'] },
                { id: 'h6', age: 23, realm: '煉氣期 巔峰', type: 'FIGHT', title: '血色試煉', location: '天南大陸 > 越國 > 血色禁地', forces: ['越國七派'], races: ['人族', '妖獸'], characters: ['韓立', '南宮婉', '墨蛟'], description: '為奪築基丹原料參加試煉。與南宮婉合力斬殺墨蛟，發生肌膚之親。獲得金色書頁。', gained: ['金頁(青元劍訣全本)', '定顏丹'], lost: ['初吻', '童子身'], techniques: [] },
                { id: 'h7', age: 25, realm: '築基期 初期', type: 'CULTIVATION', title: '築基成功', location: '天南大陸 > 越國 > 黃楓谷', forces: ['黃楓谷'], races: ['人族'], characters: ['韓立', '李化元'], description: '服用大量築基丹後終於築基。拜李化元為師，獲得闢穀與後續功法指導。', gained: ['青元劍訣(前十三層)'], lost: ['所有築基丹'], techniques: ['青元劍芒'] },
                { id: 'h8', age: 29, realm: '築基期 中期', type: 'TREASURE', title: '大衍神君(傀儡)', location: '天南大陸 > 越國 > 千竹教分壇', forces: ['千竹教'], races: ['人族'], characters: ['韓立'], description: '獲得千竹教傀儡術與大衍神君寄宿的傀儡（此時僅獲得傀儡，神君精魂未出）。得到《大衍決》。', gained: ['大衍決', '傀儡真解'], lost: [], techniques: ['大衍決'] },
                { id: 'h9', age: 31, realm: '築基期 中期', type: 'EVENT', title: '棄子傳送', location: '天南大陸 > 越國 > 古傳送陣', forces: ['魔道六宗'], races: ['人族'], characters: ['韓立', '南宮婉'], description: '魔道入侵，韓立成為棄子。巧遇南宮婉後，通過古傳送陣逃往亂星海。', gained: ['大挪移令', '亂星海新身份'], lost: ['修為倒退'], techniques: [] },
                { id: 'h11', age: 126, realm: '結丹期 初期', type: 'CULTIVATION', title: '金丹大成', location: '亂星海 > 內海 > 天星城 (聖山洞府)', forces: ['星宮'], races: ['人族'], characters: ['韓立'], description: '為求安全，租用天星城聖山第三十九層洞府閉關二十餘年，成功結丹。', gained: ['青竹蜂雲劍(培育中)'], lost: [], techniques: ['青元劍盾'] },
                { id: 'h11.2', age: 160, realm: '結丹期 後期', type: 'CRAFT', title: '煉製青竹蜂雲劍', location: '亂星海 > 外海 > 荒島洞府', forces: ['無'], races: ['人族'], characters: ['韓立'], description: '修煉至結丹後期，利用培育多年的金雷竹，耗時許久煉製成七十二口本命飛劍。', gained: ['青竹蜂雲劍(成品)', '辟邪神雷'], lost: ['金雷竹'], techniques: ['通寶決'] },
                { id: 'h13', age: 175, realm: '結丹期 後期', type: 'TREASURE', title: '虛天殿副本', location: '亂星海 > 內海 > 虛天殿', forces: ['星宮', '魔道'], races: ['人族'], characters: ['韓立', '極陰', '元瑤'], description: '人界第一副本。在元嬰老怪夾縫中求生，虎口奪食取走虛天鼎，獲得通天靈寶。獲得補天丹。', gained: ['虛天鼎', '九曲靈參', '補天丹'], lost: [], techniques: [] },
                { id: 'h14', age: 217, realm: '結丹期 後期', type: 'EVENT', title: '驚險逃亡/重返天南', location: '亂星海 > 外海 > 荒島 (古傳送陣)', forces: ['妖族'], races: ['人族', '妖族'], characters: ['韓立', '風希'], description: '被風希強迫煉製風雷翅。利用勾魂飛靈偷襲風希，奪取風雷翅，通過地下古傳送陣驚險逃回天南。', gained: ['風雷翅'], lost: [], techniques: ['風雷翅'] },
                { id: 'h15', age: 220, realm: '元嬰期 初期', type: 'CULTIVATION', title: '凝結元嬰', location: '天南大陸 > 溪國 > 落雲宗', forces: ['落雲宗'], races: ['人族'], characters: ['韓立', '呂洛'], description: '隱姓埋名加入落雲宗。在宗內密地利用定靈丹（九曲靈參煉製）斬斷心魔，碎丹成嬰，成為落雲宗長老。', gained: ['元嬰法體', '瞬移', '嬰火'], lost: [], techniques: ['大衍決(第四層)'] },
                { id: 'h15.5', age: 225, realm: '元嬰期 初期', type: 'FIGHT', title: '邊界賭戰', location: '天南大陸 > 邊界 > 戰場', forces: ['天南盟', '慕蘭法士'], races: ['人族', '慕蘭人'], characters: ['韓立', '慕蘭神師'], description: '代表天南出戰，與慕蘭神師（元嬰後期）周旋，展現驚人實力，一戰成名。', gained: ['大量庚精', '天南第一人稱號(雛形)'], lost: [], techniques: [] },
                { id: 'h16', age: 230, realm: '元嬰期 初期', type: 'FIGHT', title: '墜魔谷之戰', location: '天南大陸 > 東裕國 > 墜魔谷', forces: ['鬼靈門'], races: ['人族', '古魔'], characters: ['韓立', '古魔', '紫靈'], description: '為尋靈燭果入谷。斬殺古魔分魂，獲得火蟾獸內丹（太陰真火材料）。', gained: ['靈燭果', '火蟾獸內丹', '上古傀儡'], lost: [], techniques: ['三頭六臂真魔功(仿)'] },
                { id: 'h17', age: 260, realm: '元嬰期 中期', type: 'EVENT', title: '遠赴大晉', location: '大晉帝國', forces: ['大晉修仙界'], races: ['人族'], characters: ['韓立', '大衍神君'], description: '重返千竹教帶出大衍神君精魂。神君坐化前將大衍決全本傳授。', gained: ['大衍決全本', '大衍神君精魂'], lost: ['大衍神君'], techniques: [] },
                { id: 'h18', age: 295, realm: '元嬰期 中期', type: 'TREASURE', title: '昆吾山副本', location: '大晉帝國 > 南疆 > 昆吾山', forces: ['葉家'], races: ['人族', '古魔'], characters: ['韓立', '元剎聖祖', '玲瓏'], description: '昆吾山封印破裂。韓立混入其中，大戰古魔元剎。見識化神期大能出手。', gained: ['黑風旗', '赤魂石', '太陰真火'], lost: [], techniques: [] },
                { id: 'h21', age: 800, realm: '化神期 初期', type: 'CULTIVATION', title: '人間化神', location: '天南大陸 > 溪國 > 落雲宗', forces: ['落雲宗'], races: ['人族'], characters: ['韓立'], description: '在人界靈氣匱乏條件下，憑藉五行合一與元磁神光，強行突破化神期。', gained: ['化神期修為'], lost: [], techniques: ['縮地成寸', '元磁神光'] },
                { id: 'h22', age: 900, realm: '化神期 初期', type: 'EVENT', title: '偷渡靈界(失敗)', location: '人界 > 空間節點', forces: ['無'], races: ['人族', '妖族'], characters: ['韓立', '冰鳳'], description: '與冰鳳聯手闖空間節點。遭遇空間風暴，法寶盡毀，修為大跌，墜入靈界。', gained: ['靈界機緣'], lost: ['修為(跌落)'], techniques: [] }
                ],
                SPIRIT: [
                { id: 's1', age: 1000, realm: '化神期 中期', type: 'EVENT', title: '天淵城青冥衛', location: '靈界 > 風元大陸 > 天淵城', forces: ['天淵城'], races: ['人族'], characters: ['韓立', '雷蘭'], description: '修為恢復後，為獲取滅塵丹（抵禦靈界同化），加入天淵城擔任青冥衛。', gained: ['青冥衛身份', '滅塵丹'], lost: [], techniques: ['金篆文(初步)'] },
                { id: 's3', age: 1300, realm: '化神期 巔峰', type: 'EVENT', title: '飛靈族副本', location: '靈界 > 蠻荒 > 飛靈族領地', forces: ['天鵬族'], races: ['飛靈族'], characters: ['韓立', '金悅'], description: '誤入飛靈族領地，冒充天鵬族聖子參加試煉。', gained: ['天鵬族聖子身份', '雷鵬之骨'], lost: [], techniques: ['風雷翅(進化)'] },
                { id: 's4', age: 1350, realm: '煉虛期 初期', type: 'CULTIVATION', title: '煉虛期突破', location: '靈界 > 飛靈族 > 五色族聖地', forces: ['五色族'], races: ['飛靈族'], characters: ['韓立'], description: '躲藏在五色孔雀族的聖地禁制中，利用冥河神乳與五色神光，一舉突破至煉虛期。', gained: ['煉虛期修為', '五色孔雀真血'], lost: ['冥河神乳'], techniques: ['驚蟄十二變(五色孔雀變)'] },
                { id: 's7', age: 1500, realm: '煉虛期 後期', type: 'TREASURE', title: '廣寒界', location: '靈界 > 雷鳴大陸 > 廣寒界', forces: ['雲城'], races: ['多族混雜'], characters: ['韓立', '柳水兒'], description: '進入廣寒界，尋得《煉神術》後續與「山岳巨猿」真靈之血。收服仙傀儡（蟹道人前身）。', gained: ['煉神術', '山岳巨猿真血', '太乙青山', '仙傀儡'], lost: [], techniques: ['百脈煉寶決'] },
                { id: 's8', age: 2000, realm: '合體期 初期', type: 'CULTIVATION', title: '進階合體', location: '靈界 > 風元大陸 > 魔金山脈', forces: ['人族'], races: ['人族'], characters: ['韓立'], description: '在魔氣之地衝擊合體成功。引發驚人天象。', gained: ['合體期修為'], lost: [], techniques: ['梵聖真魔功(大成)', '法相金身'] },
                { id: 's9', age: 2100, realm: '合體期 中期', type: 'EVENT', title: '魔界洗靈池', location: '魔界 > 聖祖領地 > 洗靈池', forces: ['魔界'], races: ['魔族'], characters: ['韓立', '紫靈', '蟹道人'], description: '深入魔界尋找洗靈池。找回紫靈，喚醒並收服蟹道人。', gained: ['蟹道人(正式跟隨)', '紫靈(重逢)', '光陰之絲'], lost: [], techniques: ['涅槃聖體'] },
                { id: 's9.5', age: 2120, realm: '合體期 後期', type: 'PET_EVO', title: '噬金蟲王', location: '魔界 > 蠻荒', forces: ['無'], races: ['奇蟲'], characters: ['韓立', '金童'], description: '噬金蟲互相吞噬，誕生半步真仙級的「噬金蟲王」(金童)。', gained: ['噬金蟲王(金童)'], lost: ['大量噬金蟲'], techniques: [] },
                { id: 's12', age: 2400, realm: '大乘期', type: 'CULTIVATION', title: '成就大乘', location: '靈界 > 風元大陸 > 廣武城荒野', forces: ['人族'], races: ['人族'], characters: ['韓立', '莫簡離'], description: '在廣武城附近荒野密地突破大乘期，引發天地異象。乘坐墨靈聖舟回歸。', gained: ['大乘期修為', '言出法隨'], lost: [], techniques: ['元合五極山'] },
                { id: 's13', age: 2450, realm: '大乘期', type: 'FIGHT', title: '斬殺真仙馬良', location: '靈界 > 風元大陸 > 鳴煞之地', forces: ['靈界萬族'], races: ['真仙'], characters: ['韓立', '馬良', '蟹道人', '噬金蟲王'], description: '仙界叛徒馬良血祭下界。韓立集合全界之力弒仙！', gained: ['盜天瓶(仿)', '真仙遺骸', '成套仙器'], lost: [], techniques: ['玄天斬靈劍'] },
                { id: 's15', age: 11000, realm: '渡劫飛升', type: 'EVENT', title: '飛升大劫', location: '靈界 > 飛升台', forces: ['無'], races: ['人族'], characters: ['韓立'], description: '度過極其恐怖的飛升之劫，肉身成聖，前往北寒仙域。', gained: ['仙界資格'], lost: ['天倫之樂'], techniques: [] }
                ],
                IMMORTAL: [
                { id: 'i1', age: '11000+', realm: '凡人(暫)', type: 'EVENT', title: '失憶開局', location: '仙界 > 北寒仙域 > 靈寰界', forces: ['冷焰宗下屬'], races: ['人族', '獸族'], characters: ['韓立(厲飛雨)', '柳樂兒'], description: '飛升被偷襲，跌落靈寰界，記憶全失。化名厲飛雨。', gained: ['柳樂兒(羈絆)'], lost: ['記憶', '修為'], techniques: ['萬竅空寂術'] },
                { id: 'i3.5', age: '13000+', realm: '真仙境 後期', type: 'TREASURE', title: '冥寒仙府', location: '仙界 > 北寒仙域 > 冥寒仙府', forces: ['北寒仙宮'], races: ['仙人'], characters: ['韓立', '蕭晉寒'], description: '進入冥寒仙府，與天庭監察使公輸久大戰。斬殺蕭晉寒。', gained: ['太乙丹'], lost: [], techniques: [] },
                { id: 'i4', age: '13500+', realm: '金仙境 初期', type: 'TREASURE', title: '燭龍道與掌天瓶', location: '仙界 > 古雲大陸 > 燭龍道', forces: ['燭龍道'], races: ['仙人'], characters: ['韓立', '百里炎', '瓶靈'], description: '加入燭龍道。尋回掌天瓶，發現瓶靈。', gained: ['掌天瓶(歸位)', '真實之眼'], lost: [], techniques: ['真言化輪經'] },
                { id: 'i7', age: '15000+', realm: '太乙玉仙', type: 'FIGHT', title: '灰界與大羅一擊', location: '灰界 > 九幽域', forces: ['九幽域'], races: ['灰界生物'], characters: ['韓立', '石穿空'], description: '誤入灰界。利用掌天瓶穿越時空，借用前世大羅修為一擊破敵。', gained: ['太乙修為', '天狐化血刀'], lost: [], techniques: [] },
                { id: 'i9', age: '18000+', realm: '大羅境 初期', type: 'CULTIVATION', title: '大羅境突破', location: '仙界 > 金源仙域 > 花枝洞天', forces: ['天庭'], races: ['仙人'], characters: ['韓立'], description: '在花枝洞天內利用歲月神燈與時間差閉關苦修，突破至大羅初期。', gained: ['大羅修為', '歲月神燈'], lost: [], techniques: ['大五行幻世訣'] },
                { id: 'i10', age: '20000+', realm: '大羅境 中期', type: 'FIGHT', title: '積鱗空境', location: '積鱗空境 > 傀儡城', forces: ['傀儡城'], races: ['傀儡'], characters: ['韓立', '蟹道人(傀儡道祖)'], description: '跌入積鱗空境。助蟹道人奪回道祖之軀。', gained: ['肉身圓滿', '蟹道人(道祖級盟友)'], lost: [], techniques: ['天煞鎮獄功'] },
                { id: 'i14', age: '25000+', realm: '道祖境', type: 'FIGHT', title: '天庭終戰', location: '仙界 > 天庭 > 混沌虛空', forces: ['天庭'], races: ['全種族'], characters: ['韓立', '古或今', '魔主', '輪迴殿主'], description: '韓立成就時間道祖，擊敗企圖獻祭三界的古或今。', gained: ['時間道祖果位'], lost: [], techniques: ['言出法隨'] },
                { id: 'i15', age: '∞', realm: '大道至尊', type: 'EVENT', title: '逍遙永生', location: '諸天萬界', forces: ['韓家'], races: ['仙人'], characters: ['韓立', '南宮婉'], description: '自斬道祖果位，隱居仙界，號「韓天尊」。', gained: ['真正的大逍遙'], lost: ['道祖權柄'], techniques: [] }
                ]
            };

            const currentData = useMemo(() => ALL_DATA[activeWorld], [activeWorld]);

            const filteredData = useMemo(() => {
                return currentData.filter(item => {
                    const matchesType = filterType === 'ALL' || item.type === filterType;
                    const matchesSearch = item.title.includes(searchTerm) || 
                                        item.description.includes(searchTerm) ||
                                        (item.gained && item.gained.some(g => g.includes(searchTerm)));
                    return matchesType && matchesSearch;
                });
            }, [currentData, filterType, searchTerm]);

            useEffect(() => {
                setExpandedId(null);
            }, [activeWorld]);

            const CurrentWorldIcon = WORLDS[activeWorld].icon;

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-sans p-4 md:p-8 transition-colors duration-700">
                    
                    {/* Background */}
                    <div className={`fixed inset-0 bg-gradient-to-br opacity-20 pointer-events-none transition-all duration-1000 ${
                        activeWorld === 'HUMAN' ? 'from-emerald-900 via-slate-900 to-slate-900' :
                        activeWorld === 'SPIRIT' ? 'from-purple-900 via-slate-900 to-indigo-900' :
                        'from-amber-900 via-slate-900 to-yellow-900'
                    }`}></div>

                    {/* Header */}
                    <header className="relative max-w-5xl mx-auto mb-10 text-center space-y-4 z-10">
                        <h1 className={`text-4xl md:text-6xl font-bold tracking-wider text-transparent bg-clip-text bg-gradient-to-r ${WORLDS[activeWorld].color} drop-shadow-[0_2px_10px_rgba(0,0,0,0.8)] transition-all duration-500`}>
                            韓立修仙編年史 <span className="text-sm align-top text-slate-500 font-mono opacity-50">{APP_VERSION}</span>
                        </h1>
                        <div className="flex items-center justify-center gap-3 text-slate-400">
                            <p className="text-sm md:text-base tracking-[0.2em] uppercase">
                                A Record of a Mortal's Journey to Immortality
                            </p>
                            <span className="w-1 h-1 bg-slate-500 rounded-full"></span>
                            <p className="text-xs md:text-sm font-mono text-slate-500">
                                {WORLDS[activeWorld].years}
                            </p>
                        </div>

                        {/* View Switcher (New V8 Feature) */}
                        <div className="flex justify-center mt-6 mb-4">
                            <div className="bg-slate-900/80 p-1 rounded-lg border border-slate-700 inline-flex">
                                <button 
                                    onClick={() => setViewMode('TIMELINE')}
                                    className={`px-4 py-1.5 rounded-md text-sm font-bold flex items-center gap-2 transition-all ${viewMode === 'TIMELINE' ? 'bg-slate-700 text-white shadow' : 'text-slate-500 hover:text-slate-300'}`}
                                >
                                    <Clock size={16} /> 時間長河
                                </button>
                                <button 
                                    onClick={() => setViewMode('NETWORK')}
                                    className={`px-4 py-1.5 rounded-md text-sm font-bold flex items-center gap-2 transition-all ${viewMode === 'NETWORK' ? 'bg-indigo-600 text-white shadow' : 'text-slate-500 hover:text-slate-300'}`}
                                >
                                    <Share2 size={16} /> 因果星盤
                                </button>
                            </div>
                        </div>

                        {/* World Selectors (Only show in Timeline mode or if Network is global) */}
                        {viewMode === 'TIMELINE' && (
                            <div className="grid grid-cols-3 gap-2 md:gap-4 mt-4 max-w-3xl mx-auto">
                                {Object.entries(WORLDS).map(([key, config]) => {
                                    const isActive = activeWorld === key;
                                    const Icon = config.icon;
                                    return (
                                        <button
                                            key={key}
                                            onClick={() => setActiveWorld(key)}
                                            className={`group relative flex flex-col md:flex-row items-center justify-center gap-2 px-2 py-3 md:py-4 rounded-xl transition-all duration-300 border ${
                                                isActive 
                                                    ? `bg-slate-800 border-${config.color.split('-')[1]}-500/50 text-white shadow-lg scale-105` 
                                                    : 'bg-slate-900/50 border-slate-700/50 text-slate-500 hover:bg-slate-800 hover:text-slate-300'
                                            }`}
                                        >
                                            <Icon size={20} className={isActive ? `text-${config.color.split('-')[1]}-400` : ''} />
                                            <div className="text-center md:text-left">
                                                <div className={`text-sm font-bold ${isActive ? 'opacity-100' : 'opacity-80'}`}>{config.label}</div>
                                                <div className="text-[10px] opacity-60 font-mono hidden md:block">{config.desc}</div>
                                            </div>
                                            {isActive && (
                                                <span className={`absolute -bottom-1 left-1/2 w-16 h-0.5 -translate-x-1/2 bg-gradient-to-r ${config.color}`}></span>
                                            )}
                                        </button>
                                    )
                                })}
                            </div>
                        )}
                    </header>

                    {/* MAIN CONTENT AREA */}
                    <div className="max-w-4xl mx-auto relative pl-4 md:pl-0 z-10 min-h-[50vh]">
                        
                        {/* CONDITIONAL RENDERING BASED ON VIEW MODE */}
                        {viewMode === 'NETWORK' ? (
                            <RelationshipGraph />
                        ) : (
                            <>
                                {/* Timeline Controls */}
                                <div className="mb-8 sticky top-4 z-20 bg-slate-900/90 backdrop-blur-xl p-4 rounded-2xl border border-slate-700/50 shadow-2xl">
                                    <div className="flex flex-col md:flex-row gap-4 items-center justify-between">
                                        <div className="flex flex-wrap gap-2 justify-center md:justify-start w-full md:w-auto">
                                            <button onClick={() => setFilterType('ALL')} className={`px-4 py-1.5 rounded-full text-xs font-medium transition-all ${filterType === 'ALL' ? 'bg-slate-100 text-slate-900' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>全部</button>
                                            {Object.entries(EVENT_TYPES).map(([key, config]) => (
                                                <button key={key} onClick={() => setFilterType(key)} className={`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-all border ${filterType === key ? `bg-slate-800 ${config.color} ${config.border}` : 'bg-slate-800/0 border-transparent text-slate-500 hover:bg-slate-800'}`}>
                                                    <config.icon size={12} /> {config.label}
                                                </button>
                                            ))}
                                        </div>
                                        <div className="relative w-full md:w-64">
                                            <Search className="absolute left-3 top-2.5 text-slate-500" size={16} />
                                            <input type="text" placeholder="搜尋法寶、宗門、地點..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full bg-slate-950/50 text-slate-200 text-sm pl-10 pr-4 py-2 rounded-lg border border-slate-700 focus:outline-none focus:border-slate-500 transition-colors" />
                                        </div>
                                    </div>
                                </div>

                                {/* Empty State */}
                                {filteredData.length === 0 && (
                                    <div className="text-center py-20 text-slate-600">
                                        <div className="inline-block p-4 rounded-full bg-slate-900 mb-4"><Search size={32} /></div>
                                        <p>找不到相關記錄，請嘗試其他關鍵字</p>
                                    </div>
                                )}

                                {/* Timeline Line */}
                                <div className={`absolute left-4 md:left-1/2 top-0 bottom-0 w-0.5 bg-gradient-to-b from-transparent via-slate-700 to-transparent transform md:-translate-x-1/2`}></div>

                                {/* Timeline Items */}
                                <div className="space-y-12 pb-24">
                                    {filteredData.map((item, index) => {
                                        const isExpanded = expandedId === item.id;
                                        const isEven = index % 2 === 0;
                                        const eventConfig = EVENT_TYPES[item.type] || EVENT_TYPES.EVENT;
                                        const locParts = item.location.split(' > ');
                                        const mainRegion = locParts[0];
                                        const subRegion = locParts[1] || '';
                                        const spot = locParts[2] || '';

                                        return (
                                            <div key={item.id} className={`relative flex items-center md:justify-between ${isEven ? 'md:flex-row-reverse' : ''} animate-in fade-in slide-in-from-bottom-4 duration-500`}>
                                                <div className={`absolute left-4 md:left-1/2 w-9 h-9 rounded-full bg-slate-900 border-2 border-slate-600 flex items-center justify-center transform -translate-x-1/2 z-10 shadow-lg ${isExpanded ? 'border-white scale-110' : ''} transition-all group-hover:border-${eventConfig.color.split('-')[1]}-400`}>
                                                    <span className={`text-[10px] font-bold ${eventConfig.color}`}>{item.age}</span>
                                                </div>

                                                <div className="ml-12 md:ml-0 md:w-[45%] w-full">
                                                    <div className="flex items-center gap-2 mb-0 px-2">
                                                        <div className="flex items-center bg-slate-800/80 border border-slate-700 border-b-0 rounded-t-lg px-3 py-1.5 text-[10px] text-slate-400 font-mono tracking-tight shadow-sm backdrop-blur-sm">
                                                            <span className="text-slate-500 mr-1.5"><Navigation size={10} /></span>
                                                            <span className="text-slate-300 font-bold">{mainRegion}</span>
                                                            {subRegion && <span className="mx-1 text-slate-600">&gt;</span>}
                                                            {subRegion && <span>{subRegion}</span>}
                                                        </div>
                                                        {item.forces && item.forces.length > 0 && (
                                                            <div className="hidden md:flex items-center bg-slate-900/50 border border-slate-800 border-b-0 rounded-t-lg px-2 py-1.5 text-[10px] text-slate-500">
                                                                <Landmark size={10} className="mr-1" /> {item.forces[0]}
                                                            </div>
                                                        )}
                                                    </div>

                                                    <div className={`group relative bg-slate-900/60 backdrop-blur-md border border-slate-800 rounded-b-xl rounded-tr-xl overflow-hidden hover:border-slate-600 transition-all duration-300 cursor-pointer shadow-xl ${isExpanded ? 'ring-1 ring-white/20 bg-slate-800/80' : ''}`} style={{ borderTopLeftRadius: '0' }} onClick={() => setExpandedId(isExpanded ? null : item.id)}>
                                                        <div className="absolute top-3 right-3">
                                                            <span className={`text-[10px] font-mono px-2 py-0.5 rounded-full border border-white/5 bg-white/5 text-slate-300`}>{item.realm}</span>
                                                        </div>

                                                        <div className="p-5">
                                                            <div className="flex items-center gap-2 mb-2">
                                                                <span className={`text-[10px] font-bold px-2 py-0.5 rounded-sm ${eventConfig.bg} text-slate-950`}>{eventConfig.label}</span>
                                                                {spot && <span className="text-[10px] text-slate-500 flex items-center gap-1"><MapPin size={10} /> {spot}</span>}
                                                            </div>
                                                            <h3 className={`text-lg font-bold text-slate-200 mb-2 group-hover:text-white transition-colors`}>{item.title}</h3>
                                                            <p className="text-sm text-slate-400 line-clamp-2 leading-relaxed">{item.description}</p>
                                                            <div className="mt-3 flex justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                                {isExpanded ? <ChevronUp size={16} className="text-slate-500" /> : <ChevronDown size={16} className="text-slate-500" />}
                                                            </div>
                                                        </div>

                                                        {isExpanded && (
                                                            <div className="px-5 pb-5 pt-0 text-sm animate-in fade-in slide-in-from-top-1">
                                                                <div className="h-px w-full bg-slate-700/50 mb-4"></div>
                                                                <div className="space-y-4">
                                                                    <p className="text-slate-300 leading-relaxed">{item.description}</p>
                                                                    {(item.forces || item.races) && (
                                                                        <div className="flex flex-wrap gap-2 mb-3 bg-slate-950/30 p-2 rounded border border-slate-800/50">
                                                                            <div className="w-full text-[10px] uppercase tracking-wider text-slate-600 mb-1 font-bold">區域情報</div>
                                                                            {item.forces?.map(f => <span key={f} className="text-[10px] flex items-center gap-1 bg-slate-800 border border-slate-700 px-2 py-1 rounded text-slate-400"><Landmark size={10} /> {f}</span>)}
                                                                            {item.races?.map(r => <span key={r} className="text-[10px] flex items-center gap-1 bg-slate-800 border border-slate-700 px-2 py-1 rounded text-slate-400"><Flag size={10} /> {r}</span>)}
                                                                        </div>
                                                                    )}
                                                                    <div className="grid grid-cols-1 gap-3">
                                                                        {item.gained && item.gained.length > 0 && (
                                                                            <div className="bg-amber-500/10 p-3 rounded border border-amber-500/20">
                                                                                <div className="text-xs text-amber-400 mb-2 flex items-center gap-1.5 font-bold uppercase tracking-wider"><Gem size={12} /> 獲得/機緣</div>
                                                                                <div className="flex flex-wrap gap-1.5">{item.gained.map((g, i) => <span key={i} className="text-xs text-amber-200/80 bg-amber-900/30 px-2 py-1 rounded">{g}</span>)}</div>
                                                                            </div>
                                                                        )}
                                                                        {item.techniques && item.techniques.length > 0 && (
                                                                            <div className="bg-blue-500/10 p-3 rounded border border-blue-500/20">
                                                                                <div className="text-xs text-blue-400 mb-2 flex items-center gap-1.5 font-bold uppercase tracking-wider"><BookOpen size={12} /> 功法/神通</div>
                                                                                <div className="flex flex-wrap gap-1.5">{item.techniques.map((t, i) => <span key={i} className="text-xs text-blue-200/80 bg-blue-900/30 px-2 py-1 rounded">{t}</span>)}</div>
                                                                            </div>
                                                                        )}
                                                                        {item.characters && item.characters.length > 0 && (
                                                                            <div className="flex flex-wrap gap-2 items-center pt-2"><Users size={12} className="text-slate-600" />{item.characters.map((char, i) => <span key={i} className="text-[10px] text-slate-500 border border-slate-700 px-1.5 py-0.5 rounded-full">{char}</span>)}</div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </>
                        )}
                    </div>
                    
                    <div className="text-center text-slate-700 text-[10px] pb-8 uppercase tracking-widest">
                        Archive System v10.0 (Definitive Edition) • {activeWorld} Realm
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<HanLiChronicle />);
    </script>
</body>
</html>